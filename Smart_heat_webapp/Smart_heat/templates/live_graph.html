<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
  {% load static %}
<link rel="stylesheet" href="{% static 'bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'graph.css' %}">
<script src="{% static 'bootstrap.min.js' %}"></script>
</head>
<body>
<div class="container">
<center><h1>Live Graph</h1></center>
<hr>
    
    <div class="row">
		<nav>
			<ul>
				<li class="deroulant"><a href="#">Data &ensp;</a>
					<ul class="sous">
						<li><button type="button" name="meteo" id="btn_meteo" class="button1" >Température extérieure </button></li>
						<li><button type="button" name="temp1" id="btn_temp1" class="button1" >Température intérieure zone 1</button></li>
						<li><button type="button" name="temp2" id="btn_temp2" class="button1" >Température intérieure zone 2</button></li>
						<li><button type="button" name="occ1"  id="btn_occ1"  class="button1" >Occupation zone 1</button></li>
						<li><button type="button" name="occ2"  id="btn_occ1"  class="button1" >Occupation zone 2</button></li>
						<li><button type="button" name="thm1"  id="btn_thm1"  class="button1" >Thermostat zone 1</button></li>
						<li><button type="button" name="thm2"  id="btn_thm2"  class="button1" >Thermostat zone 2</button></li>
					</ul>
				</li>
				<li class="deroulant"><a href="#">Model de prédiction &ensp;</a>
					<ul class="sous">
						<li><button type="button" name="R_lin" id="btn_R_lin" class="button1" >Régression linéaire</button></li>
						<li><button type="button" name="R_bay" id="btn_R_bay" class="button1" >Régression bayésienne</button></li>
						<li><button type="button" name="R_knn" id="btn_R_knn" class="button1" >Régression par KNN</button></li>
						<li><button type="button" name="R_rnn" id="btn_R_rnn" class="button1" >Régression par RNN</button></li>
						
					</ul>
				</li>
				
				<li class="deroulant"><a href="#">Update rate &ensp;</a>
					<ul class="sous">
						<li><button type="button" name="UR_05" id="btn_ur05" class="button1" >.5 S</button></li>
						<li><button type="button" name="UR_1S" id="btn_ur1s" class="button1" >1 s</button></li>
						<li><button type="button" name="UR_1m" id="btn_ur1m" class="button1" >1 min</button></li>
						<li><button type="button" name="UR_15m" id="btn_ur15m" class="button1" >15 min </button></li>
					</ul>
				</li>
					<li><a href="#">A propos</a></li>
			</ul>
		</nav
		
		<div class="col-md-4">
           
		</div>

    </div>
     
<br><br>
<hr/>
<div class="row">
    <div id="chartContainer" style="height: 600px; width: 100%;"></div>
	
</div>


<div id="chartContainer3" style="height: 400px; width: 100%;"></div>
</div>
<br><br>

<div id="chartContainer4" style="height: 400px; width: 100%;"></div>
</div>
</body>
</div>
<br><br>

<div id="chartContainer5" style="height: 400px; width: 100%;"></div>
</div>
</body>
</div>
<br><br>

<div id="chartContainer6" style="height: 400px; width: 100%;"></div>
</div>
</body>

<script src="{% static 'jquery-3.3.1.min.js' %}"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>


<script>
$("#btn_show").click(function(){
    com=$("#comport").val();
	if(com ==1){
	
	fill_graph_sensor(com);
	
	}
	else if(com ==2){
	fill_graph_sensor2(com);
	}else{
	fill_graph_sensor3(com);
	}
    
	
	
});




function fill_graph_sensor(){
		var dps = []; // dataPoints
var chart = new CanvasJS.Chart("chartContainer", {
	animationEnabled: true,
	title: {
		text: "Consomation Enérgétique"
	},
	axisX: {
		title: "Time"
	},
	axisY: {
		title: "Consomation",
		suffix: ""
	},
	data: [{
		type: "line",
		name: "CPU Utilization",
		connectNullData: true,
		//nullDataLineDashType: "solid",
		xValueType: "dateTime",
		xValueFormatString: "DD MMM hh:mm TT",
		yValueFormatString: "#,##0.##\"mm\"",
		dataPoints: dps
	}]
});


var xVal = 0;
var yVal = 100;
var updateInterval = 400;//miliseconds
var dataLength = 40; // number of dataPoints visible at any point
var updateChart = function () {
var i = 1;


    $.ajax({
            type:"get",
            url: "{% url 'fetch_sensor_values_ajax' %}",
            data: {
                     'id': com
					 
                   },
            success: function(data) {
                console.log(data.result);
                for(index = 0; index < data.result.length; index++) {
                    var str_array = data.result[index].split(',');
                    dps.push({
								x: Date.parse(str_array[1]),
								y: Number(str_array[0])
							});
                   }
                return data;
                    },
            error: function(){
                    console.log("error he ji");
                 }
            });

		if (dps.length > dataLength) {
		dps.shift();
		}

		chart.render();
		
};


updateChart(dataLength);
setInterval(function(){updateChart()}, updateInterval);
}

function fill_graph_sensor2(){
		var dps1 = []; // dataPoints
var chart3 = new CanvasJS.Chart("chartContainer3", {
	animationEnabled: true,
	title: {
		text: "Consomation Enérgétique"
	},
	axisX: {
		title: "Time"
	},
	axisY: {
		title: "Consomation",
		suffix: ""
	},
	data: [{
		type: "line",
		name: "CPU Utilization",
		connectNullData: true,
		//nullDataLineDashType: "solid",
		xValueType: "dateTime",
		xValueFormatString: "DD MMM hh:mm TT",
		yValueFormatString: "#,##0.##\"mm\"",
		dataPoints: dps1
	}]
});


var xVal = 0;
var yVal = 100;
var updateInterval = 4000;//miliseconds
var dataLength = 20; // number of dataPoints visible at any point
var updateChart = function () {

    $.ajax({
            type:"get",
            url: "{% url 'fetch_sensor_values_ajax' %}",
            data1: {
                     'id': com
                   },
            success: function(data1) {
                console.log(data1.result);
                for(index = 0; index < data1.result.length; index++) {
                    var str_array = data1.result[index].split(',');
                    dps1.push({
								x: Date.parse(str_array[1]),
								y: Number(str_array[0])
							});
                   }
                return data1;
                    },
            error: function(){
                    console.log("error he ji");
                 }
            });

		if (dps1.length > dataLength) {
		dps1.shift();
		}

		chart3.render();
		
		
};


updateChart(dataLength);
setInterval(function(){updateChart()}, updateInterval);
}
function fill_graph_sensor3(){
		var dps1 = []; // dataPoints
var chart5 = new CanvasJS.Chart("chartContainer5", {
	animationEnabled: true,
	title: {
		text: "Consomation Enérgétique"
	},
	axisX: {
		title: "Time"
	},
	axisY: {
		title: "Consomation",
		suffix: ""
	},
	data: [{
		type: "line",
		name: "CPU Utilization",
		connectNullData: true,
		//nullDataLineDashType: "solid",
		xValueType: "dateTime",
		xValueFormatString: "DD MMM hh:mm TT",
		yValueFormatString: "#,##0.##\"mm\"",
		dataPoints: dps1
	}]
});
var chart6 = new CanvasJS.Chart("chartContainer6", {
	animationEnabled: true,
	title: {
		text: "Consomation Enérgétique"
	},
	axisX: {
		title: "Time"
	},
	axisY: {
		title: "Consomation",
		suffix: ""
	},
	data: [{
		type: "line",
		name: "CPU Utilization",
		connectNullData: true,
		//nullDataLineDashType: "solid",
		xValueType: "dateTime",
		xValueFormatString: "DD MMM hh:mm TT",
		yValueFormatString: "#,##0.##\"mm\"",
		dataPoints: dps1
	}]
});

var xVal = 0;
var yVal = 100;
var updateInterval = 4000;//miliseconds
var dataLength = 20; // number of dataPoints visible at any point
var updateChart = function () {

    $.ajax({
            type:"get",
            url: "{% url 'fetch_sensor_values_ajax3' %}",
            data1: {
                     'id': com
                   },
            success: function(data1) {
                console.log(data1.result);
                for(index = 0; index < data1.result.length; index++) {
                    var str_array = data1.result[index].split(',');
                    dps1.push({
								x: Date.parse(str_array[1]),
								y: Number(str_array[0])
							});
                   }
                return data1;
                    },
            error: function(){
                    console.log("error he ji");
                 }
            });

		if (dps1.length > dataLength) {
		dps1.shift();
		}

		chart5.render();
		chart6.render();
		
};


updateChart(dataLength);
setInterval(function(){updateChart()}, updateInterval);
}


</script>


</html>